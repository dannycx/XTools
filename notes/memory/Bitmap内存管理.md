# Bitmap内存管理

* 在Android 8.0之后，Bitmap的内存分配从Java堆转移到了Native堆中，所以我们可以通过Android profiler性能检测工具查看内存使用情况
* 内存泄漏：程序申请内存后，无法释放已申请的内存空间，导致内存资源浪费和占用。
* 内存溢出：程序申请内存时，没有足够的内存空间供其使用，或者申请的内存空间小于存储的数据大小，导致程序无法正常运行或报错。
* 内存泄漏可能会导致内存溢出

## 前言
这篇文章中，将讲解以下内容
* 一张Bitmap对内存的占用
* AS如何分析图片占用内存
* 介绍Glide、Picasso加载图片使用内存方式
* 分析不同drawable目录下图片的显示策略
* 基于手机内存、版本，提出一种优化内存分配的方案

### 内存占用
* 图片大小 == 占用内存大小，这种想法是不对的
* 图片占用内存的大小并不取决于它本身的大小，而取决于图片加载框架所采用的加载方式所申请的内存大小
+ 图片举例：
    图片尺寸：350*350
    图片大小：36KB

+ 创建一个简单的Demo，页面正中央是一个ImageView，用于显示这张图片。

* 通过AS进行heap dump，从而看图片所占用的内存。首先我们将显示图片时的内存快照保存下来。操作路径为Profiler -> Memory -> Heap Dump，这会生成一个dump文件，在其中可以看到当前堆的使用情况。
* 通过查看，程序运行时，这张图片占用的内存（Retained Size）是2560000bytes，约等于2.4MB内存。与它在磁盘上36KB的大小，相差了整整70倍！

小技巧：如何查看dump文件中的图片
* 在调试时，如果我们手头只有一个dump文件，往往需要还原图片内容，以帮助定位问题。有两种方式可以从dump文件里提取原图片，这里只介绍AS方式。
方式一：通过AS直接查看
* 如果dump文件来源自Android版本为7.1.1（Android N，API=25）及以下的设备，可以使用这种方法。选中Bitmap对象，直接在窗口的Bitmap Preview中查看图片内容，非常方便。

